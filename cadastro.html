<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cadastro — Tô com meu pet</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css">
  
</head>
<body>
<nav class="navbar navbar-expand-lg bg-light border-bottom navbar-light">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="index.html">
      <img src="img/logositelongo.png" alt="Logo Tô com meu pet" class="navbar-logo me-2">
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain"
            aria-controls="navMain" aria-expanded="false" aria-label="Alternar navegação">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div id="navMain" class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="index.html">Início</a></li>
        <li class="nav-item"><a class="nav-link" href="produtos.html">Produtos</a></li>
        <li class="nav-item"><a class="nav-link" href="servicos.html">Serviços</a></li>
        <li class="nav-item"><a class="nav-link active" href="cadastro.html" aria-current="page">Cadastro</a></li>
        <li class="nav-item"><a class="nav-link" href="agendamento.html">Agendamento</a></li>
        <li class="nav-item"><a class="nav-link" href="sobre.html">Sobre</a></li>
        <li class="nav-item"><a class="nav-link" href="ajuda.html">Ajuda</a></li>
      </ul>
    </div>
  </div>
</nav>

<main class="container my-4">
  <h1 class="h3 mb-3">Cadastro do Cliente e do Pet</h1>

  <form id="formCadastro" class="needs-validation" novalidate>
    <fieldset class="border rounded p-3 mb-4">
      <legend class="float-none w-auto px-2">Dados do Cliente</legend>

      <div class="row g-3">
        <div class="col-md-6">
          <label for="nome" class="form-label">Nome completo *</label>
          <input type="text" id="nome" name="nome" class="form-control" required placeholder="Fulano da Silva" autocomplete="name">
          <div class="invalid-feedback">Informe seu nome.</div>
        </div>

        <div class="col-md-3">
          <label for="cpf" class="form-label">CPF *</label>
          <input
            type="text"
            id="cpf"
            name="cpf"
            class="form-control"
            required
            placeholder="000.000.000-00"
            inputmode="numeric"
            maxlength="14"
            autocomplete="off"
            pattern="\d{3}\.\d{3}\.\d{3}-\d{2}"
          >
          <div class="invalid-feedback">Digite um CPF válido (000.000.000-00).</div>
        </div>

        <div class="col-md-3">
          <fieldset class="m-0 p-0 border-0">
            <legend class="form-label fs-6 mb-1">Sexo *</legend>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="sexo" id="sxM" value="M" required>
              <label class="form-check-label" for="sxM">Masculino</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="sexo" id="sxF" value="F">
              <label class="form-check-label" for="sxF">Feminino</label>
            </div>
            <div class="invalid-feedback d-block" id="sexoFeedback" style="display:none;">Selecione uma opção.</div>
          </fieldset>
        </div>

        <div class="col-md-6">
          <label for="email" class="form-label">E-mail *</label>
          <input type="email" id="email" name="email" class="form-control" required placeholder="voce@exemplo.com" autocomplete="email">
          <div class="invalid-feedback">E-mail inválido.</div>
        </div>

        <div class="col-md-6">
          <label for="telefone" class="form-label">Telefone *</label>
          <input
            type="tel"
            id="telefone"
            name="telefone"
            class="form-control"
            required
            placeholder="(11) 90000-0000"
            inputmode="tel"
            autocomplete="tel"
            pattern="\(\d{2}\)\s\d{4,5}-\d{4}"
            
          >
          <div class="invalid-feedback">Informe um telefone válido (ex.: (11) 90000-0000).</div>
        </div>

        <div class="col-12">
          <label for="endereco" class="form-label">Endereço (para Pega e traz)</label>
          <input type="text" id="endereco" name="endereco" class="form-control" placeholder="Rua, número, bairro, cidade" autocomplete="street-address" required>
        </div>
      </div>
    </fieldset>

    <fieldset class="border rounded p-3 mb-4">
      <legend class="float-none w-auto px-2">Dados do Pet</legend>

      <div class="row g-3">
        <div class="col-md-4">
          <label for="petNome" class="form-label">Nome do pet *</label>
          <input type="text" id="petNome" name="petNome" class="form-control" required autocomplete="off">
          <div class="invalid-feedback">Informe o nome do pet.</div>
        </div>
        <div class="col-md-4">
          <label for="petRaca" class="form-label">Raça *</label>
          <input type="text" id="petRaca" name="petRaca" class="form-control" required autocomplete="off">
          <div class="invalid-feedback">Informe a raça.</div>
        </div>
        <div class="col-md-4">
          <label for="petIdade" class="form-label">Idade (anos) *</label>
          <input type="number" id="petIdade" name="petIdade" class="form-control" min="0" max="30" required inputmode="numeric">
          <div class="invalid-feedback">Idade inválida (0–30).</div>
        </div>
      </div>
    </fieldset>

    <div class="form-check mb-3">
      <input class="form-check-input" type="checkbox" id="termos" required>
      <label class="form-check-label" for="termos">Confirmo que os dados estão corretos.</label>
      <div class="invalid-feedback">Você deve confirmar os dados.</div>
    </div>

    <button class="btn btn-primary" type="submit">Salvar cadastro</button>
    <div id="msgCadastro" class="mt-3" aria-live="polite"></div>
  </form>
</main>

<footer class="container text-center my-4 small">
  <hr>
  <p class="mb-0">&copy; 2025 Tô com meu pet — Todos os direitos reservados.</p>
</footer>

<!-- JS: Bootstrap + script da página -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Máscara CPF: 000.000.000-00
  const cpfInput = document.getElementById('cpf');
  cpfInput.addEventListener('input', () => {
    let v = cpfInput.value.replace(/\D/g, '').slice(0, 11);
    v = v.replace(/(\d{3})(\d)/, '$1.$2')
         .replace(/(\d{3})(\d)/, '$1.$2')
         .replace(/(\d{3})(\d{1,2})$/, '$1-$2');
    cpfInput.value = v;
  });

  // Máscara telefone: (11) 90000-0000
  const telInput = document.getElementById('telefone');

  telInput.addEventListener('input', () => {
    
    const d = telInput.value.replace(/\D/g, '').slice(0, 11); // 2 (DDD) + 9 (número)

    let out = '';
    if (d.length <= 2) {
      // digitando o DDD
      out = d;
    } else if (d.length <= 6) {
      // DDD + primeiros 4 (fixo)
      out = `(${d.slice(0,2)}) ${d.slice(2)}`;
    } else if (d.length <= 10) {
      // DDD + 8 dígitos (fixo): (11) 3456-7890
      out = `(${d.slice(0,2)}) ${d.slice(2,6)}-${d.slice(6)}`;
    } else {
      // DDD + 9 dígitos (celular): (11) 93456-7890
      out = `(${d.slice(0,2)}) ${d.slice(2,7)}-${d.slice(7)}`;
    }

    telInput.value = out;
  });

  // Validação de CPF (dígitos verificadores)
  function cpfValido(cpf) {
    cpf = cpf.replace(/\D/g, '');
    if (!cpf || cpf.length !== 11) return false;
    if (/^(\d)\1{10}$/.test(cpf)) return false; // evita repetidos

    const calcDV = (base) => {
      let soma = 0;
      for (let i = 0; i < base.length; i++) {
        soma += parseInt(base[i], 10) * (base.length + 1 - i);
      }
      const resto = soma % 11;
      return resto < 2 ? 0 : 11 - resto;
    };

    const dv1 = calcDV(cpf.slice(0,9));
    const dv2 = calcDV(cpf.slice(0,9) + dv1);
    return cpf.endsWith(String(dv1) + String(dv2));
  }

  // Feedback de sexo (radio)
  const radiosSexo = document.querySelectorAll('input[name="sexo"]');
  const sexoFeedback = document.getElementById('sexoFeedback');
  function validaSexo() {
    const selecionado = Array.from(radiosSexo).some(r => r.checked);
    sexoFeedback.style.display = selecionado ? 'none' : 'block';
    return selecionado;
  }
  radiosSexo.forEach(r => r.addEventListener('change', validaSexo));

  // Bootstrap validation + submissão
  (function () {
    const form = document.getElementById('formCadastro');
    const msg = document.getElementById('msgCadastro');

    form.addEventListener('submit', function (event) {
      // Seta validade customizada do CPF
      if (cpfInput.value && !cpfValido(cpfInput.value)) {
        cpfInput.setCustomValidity('CPF inválido');
      } else {
        cpfInput.setCustomValidity('');
      }

      // Checa radios
      const sexoOk = validaSexo();

      if (!form.checkValidity() || !sexoOk) {
        event.preventDefault();
        event.stopPropagation();
      } else {
        event.preventDefault(); // impedindo envio real nesta demo

        // Salva um resumo no localStorage (pode trocar por POST futuramente)
        const payload = {
          nome: form.nome.value.trim(),
          cpf: cpfInput.value,
          sexo: Array.from(radiosSexo).find(r => r.checked)?.value || '',
          email: form.email.value.trim(),
          telefone: telInput.value,
          endereco: form.endereco.value.trim(),
          pet: {
            nome: form.petNome.value.trim(),
            raca: form.petRaca.value.trim(),
            idade: form.petIdade.value
          },
          dataISO: new Date().toISOString()
        };
        localStorage.setItem('cadastroToComMeuPet', JSON.stringify(payload));

        msg.innerHTML = '<div class="alert alert-success mb-0">Cadastro salvo com sucesso! ✔️</div>';
        form.classList.remove('was-validated');
        form.reset();
        sexoFeedback.style.display = 'none';
      }

      form.classList.add('was-validated');
    }, false);
  })();
</script>

</body>
</html>
